<%= render "shared/sidebar" %>

<main class="main-content" data-theme="dark">
  <div class="virality-header">
    <div>
      <%= link_to "‚Üê Back to Dashboard", dash_path, class: "back-link" %>
      <h1><%= @entry.ysws %></h1>
      <p class="subtitle">Virality Stats</p>
    </div>
    <div class="cache-info">
      <% if @cached_at %>
        <span class="cache-time">Cached <%= time_ago_in_words(@cached_at) %> ago</span>
      <% end %>
      <%= link_to "üîÑ Refresh", fetch_virality_path(@entry, refresh: true), class: "refresh-btn" %>
    </div>
  </div>

  <div class="stats-summary">
    <div class="stat-card">
      <span class="stat-value"><%= @entry.github_stars || 0 %></span>
      <span class="stat-label">‚≠ê GitHub Stars</span>
    </div>
    <div class="stat-card">
      <span class="stat-value"><%= @mentions.size %></span>
      <span class="stat-label">üì£ Mentions</span>
    </div>
    <div class="stat-card">
      <span class="stat-value"><%= number_with_delimiter(@total_engagement) %></span>
      <span class="stat-label">üë• Total Engagement</span>
    </div>
  </div>

  <h2>Mentions</h2>

  <% if @mentions.empty? %>
    <p class="empty-state">No mentions found yet.</p>
  <% else %>
    <div class="mentions-list">
      <% @mentions.sort_by { |m| -(m["Engagement Count"].to_i) }.each do |mention| %>
        <div class="mention-card">
          <div class="mention-header">
            <span class="mention-source"><%= mention["Source"] %></span>
            <span class="mention-date"><%= mention["Date"] %></span>
          </div>
          <h3 class="mention-headline">
            <a href="<%= mention["URL"] %>" target="_blank"><%= mention["Headline"] %></a>
          </h3>
          <div class="mention-meta">
            <% if mention["Engagement Count"].present? && mention["Engagement Count"] > 0 %>
              <span class="engagement">
                <%= mention["Engagement Count"] %> <%= mention["Engagement Type"] %>
              </span>
            <% end %>
            <% if mention["Mentions Hack Club?"] %>
              <span class="badge badge-hc">üè¥‚Äç‚ò†Ô∏è Mentions Hack Club</span>
            <% end %>
            <% if mention["Archive URL"].present? %>
              <a href="<%= mention["Archive URL"] %>" target="_blank" class="archive-link">üì¶ Archive</a>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>
</main>

<style>
  .virality-header {
    margin-bottom: 2rem;
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
  }

  .cache-info {
    text-align: right;
  }

  .cache-time {
    display: block;
    color: #666;
    font-size: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .refresh-btn {
    background: #3a3a5e;
    color: #fff;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    text-decoration: none;
    font-size: 0.875rem;
  }

  .refresh-btn:hover {
    background: #4a4a6e;
  }

  .back-link {
    color: #888;
    text-decoration: none;
    font-size: 0.875rem;
  }

  .back-link:hover {
    color: #fff;
  }

  .subtitle {
    color: #888;
    margin-top: 0.25rem;
  }

  .stats-summary {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .stat-card {
    background: #2a2a3e;
    border-radius: 0.75rem;
    padding: 1.5rem;
    text-align: center;
  }

  .stat-value {
    display: block;
    font-size: 2rem;
    font-weight: bold;
    color: #fff;
  }

  .stat-label {
    display: block;
    font-size: 0.875rem;
    color: #888;
    margin-top: 0.25rem;
  }

  .mentions-list {
    display: flex;
    flex-direction: column;
    gap: 1rem;
  }

  .mention-card {
    background: #2a2a3e;
    border-radius: 0.75rem;
    padding: 1.25rem;
  }

  .mention-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
  }

  .mention-source {
    background: #3a3a5e;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
  }

  .mention-date {
    color: #888;
    font-size: 0.875rem;
  }

  .mention-headline {
    margin: 0.5rem 0;
    font-size: 1.1rem;
    font-weight: 500;
  }

  .mention-headline a {
    color: #6366f1;
    text-decoration: none;
  }

  .mention-headline a:hover {
    text-decoration: underline;
  }

  .mention-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 0.75rem;
    align-items: center;
    margin-top: 0.75rem;
  }

  .engagement {
    background: rgba(99, 102, 241, 0.2);
    color: #a5b4fc;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .badge-hc {
    background: rgba(236, 72, 153, 0.2);
    color: #f9a8d4;
    padding: 0.25rem 0.5rem;
    border-radius: 0.25rem;
    font-size: 0.875rem;
  }

  .archive-link {
    color: #888;
    font-size: 0.875rem;
    text-decoration: none;
  }

  .archive-link:hover {
    color: #fff;
  }

  .empty-state {
    color: #888;
    text-align: center;
    padding: 3rem;
  }

  h2 {
    margin-bottom: 1rem;
    font-size: 1.25rem;
  }
</style>
